<div class="container">
  <!-- Header con usuario -->
  <div class="header">
    <div>
      <h1>Sistema de Parqueadero</h1>
      <p>Gesti칩n de veh칤culos y cobro de servicios</p>
    </div>
    <div class="user-info">
      <span>Bienvenido, {{ currentUser?.username }}</span>
      <button class="logout-btn" (click)="logout()">Cerrar Sesi칩n</button>
      <button class="logout-btn" (click)="openChangePasswordModal()">游댏 Cambiar Contrase침a</button>
      <span> BD: {{ dbInfo?.version }} </span>
    </div>
  </div>

  <!-- Stats Grid -->
  <div class="stats-grid">
    <!-- Tarjeta de veh칤culos estacionados -->
    <div class="stat-card">
      <div class="stat-card-header">
        <div class="stat-card-title">Veh칤culos Estacionados</div>
        <svg class="stat-card-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2"></path>
          <circle cx="7" cy="17" r="2"></circle>
          <path d="M9 17h6"></path>
          <circle cx="17" cy="17" r="2"></circle>
        </svg>
      </div>
      <div class="stat-card-value">{{ stats.parkedVehicles }}</div>
    </div>

    <!-- Tarjeta de espacios disponibles -->
    <div class="stat-card">
      <div class="stat-card-header">
        <div class="stat-card-title">Espacios Disponibles</div>
        <svg class="stat-card-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"></circle>
          <path d="M9 17V7h4a3 3 0 0 1 0 6H9"></path>
        </svg>
      </div>
      <div class="stat-card-value">{{ stats.availableSpaces }}</div>
    </div>

    <!-- Tarjeta de veh칤culos hoy -->
    <div class="stat-card">
      <div class="stat-card-header">
        <div class="stat-card-title">Veh칤culos Hoy</div>
        <svg class="stat-card-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M12 6v6l4 2"></path>
          <circle cx="12" cy="12" r="10"></circle>
        </svg>
      </div>
      <div class="stat-card-value">{{ stats.vehiclesToday }}</div>
    </div>

    <!-- Tarjeta de ingresos del d칤a -->
    <div class="stat-card">
      <div class="stat-card-header">
        <div class="stat-card-title">Ingresos del D칤a</div>
        <svg class="stat-card-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="12" x2="12" y1="2" y2="22"></line>
          <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
        </svg>
      </div>
      <div class="stat-card-value">${{ stats.dailyIncome | number:'1.2-2' }}</div>
    </div>
  </div>

  <!-- Tabs Container -->
  <div class="tabs-container">
    <div class="tabs-list">
      <button 
        class="tab-button" 
        [class.active]="activeTab === 'entry'"
        (click)="setActiveTab('entry')">
        Registro de Entrada
      </button>
      <button 
        class="tab-button" 
        [class.active]="activeTab === 'parked'"
        (click)="setActiveTab('parked')">
        Veh칤culos Estacionados
      </button>
      <button 
        class="tab-button" 
        [class.active]="activeTab === 'history'"
        (click)="setActiveTab('history')">
        Historial
      </button>
      <button 
        *ngIf="role === 'ADMIN'"
        class="tab-button" 
        [class.active]="activeTab === 'reports'"
        (click)="setActiveTab('reports')">
        Reportes
      </button>
      <button 
        *ngIf="role === 'ADMIN'"
        class="tab-button" 
        [class.active]="activeTab === 'audit'"
        (click)="setActiveTab('audit')">
        Auditor칤a
      </button>
      <button 
        *ngIf="role === 'ADMIN'"
        class="tab-button" 
        [class.active]="activeTab === 'users'"
        (click)="setActiveTab('users')">
        Gesti칩n de Usuarios
      </button>
      <button 
        *ngIf="role === 'ADMIN'"
        class="tab-button" 
        [class.active]="activeTab === 'backups'"
        (click)="setActiveTab('backups')">
        Copias de Seguridad
      </button>
      <button 
        *ngIf="role === 'ADMIN'"
        class="tab-button" 
        [class.active]="activeTab === 'insights'"
        (click)="setActiveTab('insights')">
        Insights
      </button>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-state">
      <p>Cargando datos del dashboard...</p>
    </div>

    <!-- Tab Content -->
    <div *ngIf="activeTab === 'entry'">
      <app-entry (vehicleEntered)="refreshStatistics()"></app-entry>
    </div>

    <div *ngIf="activeTab === 'parked'">
      <app-parked (vehicleExited)="refreshStatistics()"></app-parked>
    </div>

    <div *ngIf="activeTab === 'history'">
      <app-history></app-history>
    </div>

    <div *ngIf="activeTab === 'reports' && role === 'ADMIN'">
      <app-reports [stats]="stats"></app-reports>
    </div>

    <div *ngIf="activeTab === 'audit' && role === 'ADMIN'">
      <app-audit-trail></app-audit-trail>
    </div>

    <div *ngIf="activeTab === 'users' && role === 'ADMIN'">
      <app-users></app-users>
    </div>

    <div *ngIf="activeTab === 'backups' && role === 'ADMIN'">
      <app-backups></app-backups>
    </div>

    <div *ngIf="activeTab === 'insights' && role === 'ADMIN'">
      <app-insights></app-insights>
    </div>
  </div>

  <!-- Modal de Cambio de Contrase침a -->
  <div class="modal-backdrop" *ngIf="showChangePasswordModal">
    <div class="modal-window">
      <h3>Cambiar Contrase침a</h3>
      <form (ngSubmit)="changePassword()">
        <label class="modal-label">Contrase침a Actual</label>
        <input 
          class="modal-input" 
          type="password" 
          [(ngModel)]="passwordForm.current" 
          name="current"
          required 
          placeholder="Ingrese contrase침a actual">

        <label class="modal-label">Nueva Contrase침a</label>
        <input 
          class="modal-input" 
          type="password" 
          [(ngModel)]="passwordForm.new" 
          name="new"
          required 
          minlength="8"
          placeholder="M칤nimo 8 caracteres">

        <label class="modal-label">Confirmar Nueva Contrase침a</label>
        <input 
          class="modal-input" 
          type="password" 
          [(ngModel)]="passwordForm.confirm" 
          name="confirm"
          required 
          placeholder="Repita la nueva contrase침a">

        <div class="modal-actions" style="margin-top: 18px;">
          <button class="btn btn-save" type="submit">Cambiar Contrase침a</button>
          <button class="btn btn-cancel" type="button" (click)="closeChangePasswordModal()">Cancelar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Refresh Button 
  <div class="refresh-section">
    <button class="refresh-btn" (click)="refreshData()">
      游댃 Actualizar Datos
    </button>
  </div>
</div> -->